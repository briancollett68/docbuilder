<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGPT to Word Document Builder</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap');

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Lexend', sans-serif;
  background: #0f172a;
  color: #e2e8f0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 24px;
}

h1 { font-size: 1.6rem; color: #93c5fd; margin-bottom: 4px; text-align: center; }
.subtitle { color: #64748b; font-size: 0.85rem; margin-bottom: 20px; text-align: center; }
.container { width: 100%; max-width: 800px; display: flex; flex-direction: column; gap: 16px; }
label { font-size: 0.85rem; color: #94a3b8; font-weight: 700; }

textarea {
  width: 100%;
  min-height: 340px;
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 10px;
  color: #e2e8f0;
  font-family: 'Lexend', sans-serif;
  font-size: 0.9rem;
  padding: 14px;
  resize: vertical;
  outline: none;
  transition: border 0.2s;
}
textarea:focus { border-color: #3b82f6; }

.title-row { display: flex; gap: 10px; align-items: center; }

.title-row input {
  flex: 1;
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 8px;
  color: #e2e8f0;
  font-family: 'Lexend', sans-serif;
  font-size: 0.9rem;
  padding: 10px 14px;
  outline: none;
  transition: border 0.2s;
}
.title-row input:focus { border-color: #3b82f6; }

.char-count { font-size: 0.7rem; color: #64748b; white-space: nowrap; }

button {
  padding: 14px 28px;
  font-family: 'Lexend', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary { background: linear-gradient(135deg, #3b82f6, #2563eb); color: #fff; width: 100%; }
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }

.status { text-align: center; font-size: 0.85rem; min-height: 1.2em; }
.status.ok { color: #4ade80; }
.status.err { color: #f87171; }
.status.loading { color: #facc15; }

.preview {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 10px;
  padding: 14px;
  font-size: 0.8rem;
  color: #94a3b8;
  max-height: 160px;
  overflow-y: auto;
  line-height: 1.5;
}
.preview b { color: #93c5fd; }
.preview .h1 { color: #60a5fa; font-weight: 700; font-size: 0.95rem; }
.preview .h2 { color: #60a5fa; font-weight: 700; font-size: 0.88rem; padding-left: 6px; }
.preview .bullet { padding-left: 20px; }

.title-preview {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 8px;
  padding: 10px;
  text-align: center;
  font-size: 0.8rem;
  color: #60a5fa;
  line-height: 1.6;
  display: none;
}
.title-preview span { color: #64748b; font-size: 0.7rem; display: block; margin-bottom: 4px; }
</style>
</head>
<body>

<h1>ChatGPT &#8594; Word Document</h1>
<p class="subtitle">Paste ChatGPT output below. Markdown headings &amp; bullets are auto-detected.</p>

<div class="container">

  <!-- Title input -->
  <div>
    <label>Document Title (used in header — splits every 30 characters)</label>
    <div class="title-row" style="margin-top:6px">
      <input type="text" id="titleInput" placeholder="Type your document title here…">
      <span class="char-count" id="charCount">0 chars</span>
    </div>
    <div class="title-preview" id="titlePreview"><span>Header preview:</span></div>
  </div>

  <!-- Text input -->
  <div>
    <label>Paste ChatGPT Text</label>
    <textarea id="textInput" placeholder="Paste your ChatGPT output here…"></textarea>
  </div>

  <!-- Structure preview -->
  <div id="previewBox" class="preview" style="display:none"></div>

  <!-- Generate button -->
  <button class="btn-primary" id="buildBtn" disabled>Generate .docx</button>
  <div class="status" id="status"></div>

</div>

<!-- JSZip library for building .docx files -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
/* ============================================================
   ELEMENT REFERENCES
   ============================================================ */
var textArea     = document.getElementById('textInput');
var titleInput   = document.getElementById('titleInput');
var buildBtn     = document.getElementById('buildBtn');
var statusEl     = document.getElementById('status');
var previewBox   = document.getElementById('previewBox');
var charCount    = document.getElementById('charCount');
var titlePreview = document.getElementById('titlePreview');

/* ============================================================
   EVENT LISTENERS
   ============================================================ */
textArea.addEventListener('input', function () {
  checkReady();
  var v = textArea.value.trim();
  if (v) {
    parseAndPreview(v);
  } else {
    previewBox.style.display = 'none';
  }
});

titleInput.addEventListener('input', function () {
  checkReady();
  var val = titleInput.value;
  charCount.textContent = val.length + ' chars';
  if (val.trim()) {
    var lines = splitTitle(val.trim());
    var html = '<span>Header preview:</span>';
    for (var i = 0; i < lines.length; i++) {
      html += '<div>' + esc(lines[i]) + '</div>';
    }
    titlePreview.innerHTML = html;
    titlePreview.style.display = 'block';
  } else {
    titlePreview.style.display = 'none';
  }
});

buildBtn.addEventListener('click', function () {
  statusEl.className = 'status loading';
  statusEl.textContent = 'Building document…';

  var raw   = textArea.value.trim();
  var title = titleInput.value.trim();
  if (!raw || !title) return;

  var blocks = parseParagraphs(raw);

  buildDocx(title, blocks).then(function (blob) {
    var fn = title.replace(/[^a-zA-Z0-9 ]/g, '').replace(/\s+/g, '_').substring(0, 50) + '.docx';

    // Create a hidden download link and click it
    var a  = document.createElement('a');
    var url = URL.createObjectURL(blob);
    a.href = url;
    a.download = fn;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(function () { URL.revokeObjectURL(url); }, 5000);

    statusEl.className = 'status ok';
    statusEl.textContent = '\u2713 Downloaded: ' + fn;
  }).catch(function (e) {
    statusEl.className = 'status err';
    statusEl.textContent = 'Error: ' + e.message;
    console.error(e);
  });
});

/* ============================================================
   HELPERS
   ============================================================ */
function checkReady() {
  buildBtn.disabled = !(textArea.value.trim() && titleInput.value.trim());
}

function esc(s) {
  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

function xmlEsc(s) {
  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

/* Split title into lines of max 30 chars at word boundaries */
function splitTitle(title) {
  if (title.length <= 30) return [title];
  var words = title.split(/\s+/);
  var lines = [];
  var current = '';
  for (var i = 0; i < words.length; i++) {
    var w = words[i];
    if (!current) {
      current = w;
    } else if ((current + ' ' + w).length <= 30) {
      current += ' ' + w;
    } else {
      lines.push(current);
      current = w;
    }
  }
  if (current) lines.push(current);
  return lines;
}

/* ============================================================
   MARKDOWN PARSING
   ============================================================ */
function cleanInline(s) {
  s = s.replace(/\*\*\*(.+?)\*\*\*/g, '$1');
  s = s.replace(/\*\*(.+?)\*\*/g, '$1');
  s = s.replace(/\*(.+?)\*/g, '$1');
  s = s.replace(/__(.+?)__/g, '$1');
  s = s.replace(/_(.+?)_/g, '$1');
  s = s.replace(/`(.+?)`/g, '$1');
  s = s.replace(/```/g, '');
  return s.trim();
}

/* Parse bold markers into separate text runs */
function parseInlineRuns(s) {
  s = s.replace(/\*\*\*(.+?)\*\*\*/g, '**$1**');
  var runs = [];
  var re = /\*\*(.+?)\*\*/g;
  var last = 0;
  var m;
  while ((m = re.exec(s)) !== null) {
    if (m.index > last) {
      var before = s.substring(last, m.index).replace(/[*_`]/g, '');
      if (before) runs.push({ t: before, b: false });
    }
    runs.push({ t: m[1], b: true });
    last = re.lastIndex;
  }
  if (last < s.length) {
    var rest = s.substring(last).replace(/[*_`]/g, '');
    if (rest) runs.push({ t: rest, b: false });
  }
  if (runs.length === 0) runs.push({ t: cleanInline(s), b: false });
  return runs;
}

/* Parse raw text into structured blocks */
function parseParagraphs(raw) {
  var t = raw.replace(/\r\n/g, '\n').replace(/\r/g, '\n').replace(/\n{3,}/g, '\n\n');
  var lines = t.split('\n');
  var blocks = [];
  var i = 0;

  while (i < lines.length) {
    var tr = lines[i].trim();
    if (!tr) { i++; continue; }

    // Heading with #
    var hM = tr.match(/^(#{1,6})\s+(.*)/);
    if (hM) {
      var lv = hM[1].length;
      blocks.push({ type: lv <= 1 ? 'h1' : 'h2', text: cleanInline(hM[2]), raw: hM[2] });
      i++; continue;
    }

    // Bold-only line as heading
    var bL = tr.match(/^\*\*(.+?)\*\*$/);
    if (bL && tr.length < 120) {
      blocks.push({ type: 'h2', text: cleanInline(bL[1]), raw: bL[1] });
      i++; continue;
    }

    // Bullet
    var buM = tr.match(/^[-*\u2022]\s+(.*)/);
    if (buM) {
      blocks.push({ type: 'bullet', text: cleanInline(buM[1]), raw: buM[1] });
      i++; continue;
    }

    // Numbered list
    var nM = tr.match(/^\d+[.\)]\s+(.*)/);
    if (nM) {
      blocks.push({ type: 'bullet', text: cleanInline(nM[1]), raw: nM[1] });
      i++; continue;
    }

    // Normal paragraph — collect continuation lines
    var para = tr;
    var rp = tr;
    i++;
    while (i < lines.length && lines[i].trim() &&
           !lines[i].trim().match(/^(#{1,6}\s|[-*\u2022]\s|\d+[.\)]\s|\*\*.+\*\*$)/)) {
      para += ' ' + lines[i].trim();
      rp   += ' ' + lines[i].trim();
      i++;
    }
    blocks.push({ type: 'body', text: cleanInline(para), raw: rp });
  }

  return blocks;
}

/* Show structure preview */
function parseAndPreview(raw) {
  var blocks = parseParagraphs(raw);
  var html = '<b>Structure Preview:</b><br>';
  for (var i = 0; i < blocks.length; i++) {
    var b = blocks[i];
    if (b.type === 'h1')          html += '<div class="h1">H1: ' + esc(b.text) + '</div>';
    else if (b.type === 'h2')     html += '<div class="h2">H2: ' + esc(b.text) + '</div>';
    else if (b.type === 'bullet') html += '<div class="bullet">\u2022 ' + esc(b.text.substring(0, 80)) + (b.text.length > 80 ? '\u2026' : '') + '</div>';
    else                          html += '<div>' + esc(b.text.substring(0, 90)) + (b.text.length > 90 ? '\u2026' : '') + '</div>';
  }
  previewBox.innerHTML = html;
  previewBox.style.display = 'block';
}

/* ============================================================
   DOCX BUILDER — raw Open XML + JSZip
   ============================================================ */
var TWIP_INCH = 1440;
var BLUE      = '204C8D';
var MARGIN    = Math.round(TWIP_INCH * 0.5);
var HDR_DIST  = Math.round(TWIP_INCH * 0.2);
var FTR_DIST  = Math.round(TWIP_INCH * 0.2);

function hp(pt) { return pt * 2; }   /* half-points (font size unit) */
function tw(pt) { return pt * 20; }  /* twips (spacing unit) */

/* Build Word XML runs from parsed inline data */
function makeRuns(runs, sz, color, bold) {
  var xml = '';
  for (var i = 0; i < runs.length; i++) {
    var r = runs[i];
    var isBold = r.b || bold;
    xml += '<w:r><w:rPr>'
      + '<w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
      + '<w:sz w:val="' + sz + '"/><w:szCs w:val="' + sz + '"/>'
      + '<w:color w:val="' + color + '"/>'
      + (isBold ? '<w:b/><w:bCs/>' : '')
      + '</w:rPr><w:t xml:space="preserve">' + xmlEsc(r.t) + '</w:t></w:r>';
  }
  return xml;
}

/* Build document body XML from blocks */
function makeBody(blocks) {
  var xml = '';
  for (var i = 0; i < blocks.length; i++) {
    var b = blocks[i];

    if (b.type === 'h1') {
      xml += '<w:p><w:pPr><w:pStyle w:val="Heading1"/>'
        + '<w:spacing w:before="0" w:after="' + tw(12) + '" w:line="240" w:lineRule="auto"/>'
        + '</w:pPr>'
        + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
        + '<w:b/><w:bCs/><w:sz w:val="' + hp(14) + '"/><w:szCs w:val="' + hp(14) + '"/>'
        + '<w:color w:val="' + BLUE + '"/></w:rPr>'
        + '<w:t xml:space="preserve">' + xmlEsc(b.text) + '</w:t></w:r></w:p>';

    } else if (b.type === 'h2') {
      xml += '<w:p><w:pPr><w:pStyle w:val="Heading2"/>'
        + '<w:spacing w:before="0" w:after="' + tw(12) + '" w:line="240" w:lineRule="auto"/>'
        + '</w:pPr>'
        + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
        + '<w:b/><w:bCs/><w:sz w:val="' + hp(13) + '"/><w:szCs w:val="' + hp(13) + '"/>'
        + '<w:color w:val="' + BLUE + '"/></w:rPr>'
        + '<w:t xml:space="preserve">' + xmlEsc(b.text) + '</w:t></w:r></w:p>';

    } else if (b.type === 'bullet') {
      var bRuns = makeRuns(parseInlineRuns(b.raw), hp(13), '000000', false);
      xml += '<w:p><w:pPr><w:pStyle w:val="ListBullet"/>'
        + '<w:numPr><w:ilvl w:val="0"/><w:numId w:val="1"/></w:numPr>'
        + '<w:spacing w:before="0" w:after="' + tw(6) + '" w:line="240" w:lineRule="auto"/>'
        + '</w:pPr>' + bRuns + '</w:p>';

    } else {
      var pRuns = makeRuns(parseInlineRuns(b.raw), hp(13), '000000', false);
      xml += '<w:p><w:pPr>'
        + '<w:spacing w:before="0" w:after="' + tw(6) + '" w:line="240" w:lineRule="auto"/>'
        + '</w:pPr>' + pRuns + '</w:p>';
    }
  }
  return xml;
}

/* Build header XML — splits title into multiple centered lines */
function makeHeaderXml(title) {
  var lines = splitTitle(title);
  var xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<w:hdr xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">';

  for (var i = 0; i < lines.length; i++) {
    xml += '<w:p><w:pPr><w:jc w:val="center"/>'
      + '<w:spacing w:after="0" w:line="240" w:lineRule="auto"/></w:pPr>'
      + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
      + '<w:sz w:val="' + hp(16) + '"/><w:szCs w:val="' + hp(16) + '"/>'
      + '<w:color w:val="' + BLUE + '"/></w:rPr>'
      + '<w:t xml:space="preserve">' + xmlEsc(lines[i]) + '</w:t></w:r></w:p>';
  }

  /* Spacer paragraph after title */
  xml += '<w:p><w:pPr><w:spacing w:after="' + tw(6) + '" w:line="240" w:lineRule="auto"/>'
    + '<w:rPr><w:sz w:val="' + hp(1) + '"/><w:szCs w:val="' + hp(1) + '"/></w:rPr>'
    + '</w:pPr></w:p></w:hdr>';

  return xml;
}

/* Assemble all XML parts into a .docx ZIP */
function buildDocx(title, blocks) {
  var zip = new JSZip();

  /* Content Types */
  zip.file('[Content_Types].xml',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">'
    + '<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>'
    + '<Default Extension="xml" ContentType="application/xml"/>'
    + '<Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>'
    + '<Override PartName="/word/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"/>'
    + '<Override PartName="/word/numbering.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml"/>'
    + '<Override PartName="/word/header1.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.header+xml"/>'
    + '<Override PartName="/word/footer1.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml"/>'
    + '<Override PartName="/docProps/core.xml" ContentType="application/vnd.openxmlformats-package.core-properties+xml"/>'
    + '</Types>'
  );

  /* Package relationships */
  zip.file('_rels/.rels',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">'
    + '<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>'
    + '<Relationship Id="rId2" Type="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties" Target="docProps/core.xml"/>'
    + '</Relationships>'
  );

  /* Core properties (document title) */
  zip.file('docProps/core.xml',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties"'
    + ' xmlns:dc="http://purl.org/dc/elements/1.1/"'
    + ' xmlns:dcterms="http://purl.org/dc/terms/"'
    + ' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">'
    + '<dc:title>' + xmlEsc(title) + '</dc:title>'
    + '<dcterms:created xsi:type="dcterms:W3CDTF">' + new Date().toISOString() + '</dcterms:created>'
    + '</cp:coreProperties>'
  );

  /* Document relationships */
  zip.file('word/_rels/document.xml.rels',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">'
    + '<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/>'
    + '<Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering" Target="numbering.xml"/>'
    + '<Relationship Id="rId3" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/header" Target="header1.xml"/>'
    + '<Relationship Id="rId4" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/footer" Target="footer1.xml"/>'
    + '</Relationships>'
  );

  /* Styles */
  zip.file('word/styles.xml',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<w:styles xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">'
    + '<w:docDefaults>'
    + '<w:rPrDefault><w:rPr>'
    + '<w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(13) + '"/><w:szCs w:val="' + hp(13) + '"/>'
    + '<w:color w:val="000000"/>'
    + '</w:rPr></w:rPrDefault>'
    + '<w:pPrDefault><w:pPr>'
    + '<w:spacing w:before="0" w:after="' + tw(6) + '" w:line="240" w:lineRule="auto"/>'
    + '</w:pPr></w:pPrDefault>'
    + '</w:docDefaults>'
    + '<w:style w:type="paragraph" w:default="1" w:styleId="Normal"><w:name w:val="Normal"/></w:style>'
    + '<w:style w:type="paragraph" w:styleId="Heading1"><w:name w:val="heading 1"/>'
    + '<w:pPr><w:spacing w:before="0" w:after="' + tw(12) + '"/></w:pPr>'
    + '<w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/><w:b/><w:bCs/>'
    + '<w:sz w:val="' + hp(14) + '"/><w:szCs w:val="' + hp(14) + '"/><w:color w:val="' + BLUE + '"/></w:rPr></w:style>'
    + '<w:style w:type="paragraph" w:styleId="Heading2"><w:name w:val="heading 2"/>'
    + '<w:pPr><w:spacing w:before="0" w:after="' + tw(12) + '"/></w:pPr>'
    + '<w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/><w:b/><w:bCs/>'
    + '<w:sz w:val="' + hp(13) + '"/><w:szCs w:val="' + hp(13) + '"/><w:color w:val="' + BLUE + '"/></w:rPr></w:style>'
    + '<w:style w:type="paragraph" w:styleId="ListBullet"><w:name w:val="List Bullet"/>'
    + '<w:pPr><w:spacing w:before="0" w:after="' + tw(6) + '"/></w:pPr>'
    + '<w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(13) + '"/><w:szCs w:val="' + hp(13) + '"/></w:rPr></w:style>'
    + '</w:styles>'
  );

  /* Numbering (bullet definition) */
  zip.file('word/numbering.xml',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<w:numbering xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">'
    + '<w:abstractNum w:abstractNumId="0"><w:lvl w:ilvl="0">'
    + '<w:start w:val="1"/><w:numFmt w:val="bullet"/>'
    + '<w:lvlText w:val="\u2022"/><w:lvlJc w:val="left"/>'
    + '<w:pPr><w:ind w:left="720" w:hanging="360"/></w:pPr>'
    + '<w:rPr><w:rFonts w:ascii="Symbol" w:hAnsi="Symbol" w:hint="default"/></w:rPr>'
    + '</w:lvl></w:abstractNum>'
    + '<w:num w:numId="1"><w:abstractNumId w:val="0"/></w:num>'
    + '</w:numbering>'
  );

  /* Header */
  zip.file('word/header1.xml', makeHeaderXml(title));

  /* Footer with PAGE of NUMPAGES fields */
  zip.file('word/footer1.xml',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<w:ftr xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">'
    + '<w:p><w:pPr><w:jc w:val="right"/></w:pPr>'
    /* PAGE field */
    + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(10) + '"/><w:szCs w:val="' + hp(10) + '"/></w:rPr>'
    + '<w:fldChar w:fldCharType="begin"/></w:r>'
    + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(10) + '"/><w:szCs w:val="' + hp(10) + '"/></w:rPr>'
    + '<w:instrText xml:space="preserve"> PAGE </w:instrText></w:r>'
    + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(10) + '"/><w:szCs w:val="' + hp(10) + '"/></w:rPr>'
    + '<w:fldChar w:fldCharType="end"/></w:r>'
    /* " of " */
    + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(10) + '"/><w:szCs w:val="' + hp(10) + '"/></w:rPr>'
    + '<w:t xml:space="preserve"> of </w:t></w:r>'
    /* NUMPAGES field */
    + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(10) + '"/><w:szCs w:val="' + hp(10) + '"/></w:rPr>'
    + '<w:fldChar w:fldCharType="begin"/></w:r>'
    + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(10) + '"/><w:szCs w:val="' + hp(10) + '"/></w:rPr>'
    + '<w:instrText xml:space="preserve"> NUMPAGES </w:instrText></w:r>'
    + '<w:r><w:rPr><w:rFonts w:ascii="Lexend" w:hAnsi="Lexend" w:cs="Lexend"/>'
    + '<w:sz w:val="' + hp(10) + '"/><w:szCs w:val="' + hp(10) + '"/></w:rPr>'
    + '<w:fldChar w:fldCharType="end"/></w:r>'
    + '</w:p></w:ftr>'
  );

  /* Main document body */
  var bodyXml = makeBody(blocks);
  zip.file('word/document.xml',
    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'
    + '<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main"'
    + ' xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">'
    + '<w:body>' + bodyXml
    + '<w:sectPr>'
    + '<w:headerReference w:type="default" r:id="rId3"/>'
    + '<w:footerReference w:type="default" r:id="rId4"/>'
    + '<w:pgSz w:w="12240" w:h="15840"/>'
    + '<w:pgMar w:top="' + MARGIN + '" w:right="' + MARGIN + '" w:bottom="' + MARGIN + '" w:left="' + MARGIN + '"'
    + ' w:header="' + HDR_DIST + '" w:footer="' + FTR_DIST + '"/>'
    + '</w:sectPr>'
    + '</w:body></w:document>'
  );

  return zip.generateAsync({
    type: 'blob',
    mimeType: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
  });
}
</script>
</body>
</html>
